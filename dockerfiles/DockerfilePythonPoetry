# Pull base image ( slim )
FROM python:3.8-slim

# Setup pipenv to avoid spurious warnings
ENV LANG en_US.UTF-8 \
 LANGUAGE en_US:en \
 PYTHONDONTWRITEBYTECODE 1 \
 PYTHONFAULTHANDLER 1 \
 PIP_NO_CACHE_DIR=off \
 PIP_DISABLE_PIP_VERSION_CHECK=on \
 PYTHONUNBUFFERED 1

# Set working directory
ARG HOME=/home/

# curl already installed in Base Image
# get Poetry dependency manager
RUN curl -sSL "https://raw.githubusercontent.com/python-poetry/poetry/master/get-poetry.py | python3"

# install Poetry
RUN pip install poetry

# Install dependencies
WORKDIR "$HOME"
COPY poetry.lock pyproject.toml ${HOME}

# Project initialization:
RUN poetry install --no-interaction --no-ansi

# Copy source code to working directory
COPY ./src ${HOME}

# ls -l: (home) Pipfile  Pipfile.lock  main.py  requirements.txt
# Run script outside of pipenv virtual env
CMD ["python3", "main.py"]